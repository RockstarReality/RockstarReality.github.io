<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Learn Linux</title>

<style>
body {
  margin: 0;
  display: flex;
  flex-direction: column;
  background: #1e1e1e;
  color: #eaeaea;
  font-family: monospace;
}

#instructions {
  padding: 16px;
  background: #2b2b2b;
  height: 30vh;
  overflow-y: auto;
  border-bottom: 2px solid #444;
  white-space: pre-line;
}

#terminal {
  flex: 1;
  background: #000;
  padding: 12px;
  overflow-y: auto;
}

.success { color: #00ff88; }
.hint { color: #ffd866; }
.error { color: #ff5555; }
.dim { color: #888; }
</style>
</head>

<body>

<div id="instructions"></div>
<pre id="terminal"></pre>

<script>
// =================================================
// SYSTEM STATE
// =================================================
let cwd = "/home/student";
let user = "student";
let buffer = "";

let fs = {
  "/": {
    home: {
      student: {
        "readme.txt": "Welcome to Learn Linux.\nLinux rewards curiosity.",
      }
    }
  }
};

let state = {
  lastCmd: "",
  testProgress: 0
};

// =================================================
// LESSONS â€” LEVEL 1 COMPLETE
// =================================================
let lessonIndex = 0;

const lessons = [
{
  title: "Level 1.1 â€” Where am I?",
  text: "You are inside a Linux machine.\n\nShow your current directory.",
  goal: () => state.lastCmd === "pwd",
  hint: "Use the command: pwd"
},
{
  title: "Level 1.1 â€” What is here?",
  text: "List the files in this directory.",
  goal: () => state.lastCmd === "ls",
  hint: "Try: ls"
},
{
  title: "Level 1.2 â€” Move around",
  text: "Change into the root directory (/).",
  goal: () => cwd === "/",
  hint: "Use: cd /"
},
{
  title: "Level 1.2 â€” Go back home",
  text: "Return to your home directory.",
  goal: () => cwd === "/home/student",
  hint: "Use: cd /home/student"
},
{
  title: "Level 1.3 â€” Create a file",
  text: "Create a file named notes.txt.",
  goal: () => "notes.txt" in resolveDir(cwd),
  hint: "Use: touch notes.txt"
},
{
  title: "Level 1.3 â€” Read a file",
  text: "Read the contents of readme.txt.",
  goal: () => state.lastCmd === "cat readme.txt",
  hint: "Use: cat readme.txt"
},
{
  title: "Level 1.4 â€” Who are you?",
  text: "Find out which user you are.",
  goal: () => state.lastCmd === "whoami",
  hint: "Use: whoami"
},
{
  title: "Level 1.4 â€” Your identity",
  text: "Display your user and group IDs.",
  goal: () => state.lastCmd === "id",
  hint: "Use: id"
},
{
  title: "ðŸ§ª Level 1 Final Test",
  text:
`This is a real mini challenge.

Tasks:
1. Go to the root directory
2. Return to your home directory
3. List the files
4. Read readme.txt
5. Show which user you are

No hints unless you ask for them.
Take your time.`,
  goal: () => state.testProgress >= 5,
  hint: "Break it down. One task at a time."
}
];

// =================================================
// UI
// =================================================
const instr = document.getElementById("instructions");
const term = document.getElementById("terminal");

function loadLesson() {
  const l = lessons[lessonIndex];
  instr.textContent = `ðŸ“˜ ${l.title}\n\n${l.text}`;
}

function print(text, cls="") {
  term.textContent += "\n" + text;
  term.scrollTop = term.scrollHeight;
}

function prompt() {
  term.textContent += `\n$ ${buffer}`;
  term.scrollTop = term.scrollHeight;
}

loadLesson();
prompt();

// =================================================
// INPUT HANDLING
// =================================================
document.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    execute(buffer.trim());
    buffer = "";
  } else if (e.key === "Backspace") {
    buffer = buffer.slice(0, -1);
  } else if (e.key.length === 1) {
    buffer += e.key;
  }
  redraw();
});

function redraw() {
  term.textContent = term.textContent.split("\n$")[0];
  prompt();
}

// =================================================
// COMMAND EXECUTION
// =================================================
function execute(input) {
  state.lastCmd = input;
  print(`$ ${input}`);

  const parts = input.split(" ");
  const cmd = parts[0];
  const arg = parts.slice(1).join(" ");

  if (cmd === "help" || input.endsWith("-h")) {
    print("Commands: pwd, ls, cd, touch, cat, whoami, id, hint");
  }
  else if (cmd === "hint") {
    print(lessons[lessonIndex].hint, "hint");
  }
  else if (cmd === "pwd") {
    print(cwd);
  }
  else if (cmd === "ls") {
    print(Object.keys(resolveDir(cwd)).join(" "));
  }
  else if (cmd === "cd") {
    if (arg === "/") cwd = "/";
    else if (arg === "..") cwd = cwd.split("/").slice(0,-1).join("/") || "/";
    else cwd = cwd + "/" + arg;
  }
  else if (cmd === "touch") {
    resolveDir(cwd)[arg] = "";
  }
  else if (cmd === "cat") {
    let dir = resolveDir(cwd);
    if (dir[arg]) print(dir[arg]);
    else print("No such file", "error");
  }
  else if (cmd === "whoami") {
    print(user);
  }
  else if (cmd === "id") {
    print(`uid=1000(${user}) gid=1000(${user}) groups=1000(${user})`);
  }
  else {
    print("command not found", "error");
  }

  // Final test tracking
  if (lessons[lessonIndex].title.includes("Final Test")) {
    if (input === "cd /") state.testProgress++;
    if (input === "cd /home/student") state.testProgress++;
    if (input === "ls") state.testProgress++;
    if (input === "cat readme.txt") state.testProgress++;
    if (input === "whoami") state.testProgress++;
  }

  checkLesson();
}

// =================================================
// HELPERS
// =================================================
function resolveDir(path) {
  let parts = path.split("/").filter(Boolean);
  let cur = fs["/"];
  for (let p of parts) cur = cur[p];
  return cur;
}

function checkLesson() {
  if (lessons[lessonIndex].goal()) {
    print("âœ… Nice work! Type 'continue' to move on.", "success");
  }
  if (state.lastCmd === "continue") {
    lessonIndex++;
    if (lessonIndex < lessons.length) {
      loadLesson();
    } else {
      instr.textContent =
`ðŸŽ‰ LEVEL 1 COMPLETE

You can now:
âœ” Navigate directories
âœ” Create and read files
âœ” Understand where you are
âœ” Know who you are in the system

You didnâ€™t memorize Linux.
You *used* Linux.

Next up:
LEVEL 2 â€” Files, permissions, and control ðŸ› ï¸`;
    }
  }
}
</script>

</body>
</html>
