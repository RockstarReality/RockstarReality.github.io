<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Learn Linux</title>
<style>
*{box-sizing:border-box;} body{margin:0;font-family:monospace;display:flex;flex-direction:column;height:100vh;background:#1e1e1e;color:#eaeaea;} 
#instructions{padding:1rem;background:#2b2b2b;min-height:30vh;max-height:40vh;overflow-y:auto;border-bottom:2px solid #444;white-space: pre-line;} 
#terminal{flex:1;padding:0.75rem;background:#000;overflow-y:auto;font-size:0.9rem;line-height:1.4;} 
#input-bar{display:flex;padding:0.5rem;background:#111;border-top:2px solid #333;} 
#prompt{color:#00ff88;margin-right:0.3rem;} 
#commandInput{flex:1;background:#000;color:#fff;border:none;outline:none;font-family:monospace;font-size:1rem;} 
.success{color:#00ff88;} .hint{color:#ffd866;} .error{color:#ff5555;} .dim{color:#888;} 
@media(min-width:768px){body{flex-direction:row;}#instructions{width:40%;height:100vh;max-height:none;border-bottom:none;border-right:2px solid #444;}#terminal-container{width:60%;display:flex;flex-direction:column;height:100vh;}}
</style>
</head>
<body>

<div id="instructions"></div>
<div id="terminal-container">
  <pre id="terminal"></pre>
  <div id="input-bar">
    <span id="prompt">$</span>
    <input id="commandInput" type="text" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" placeholder="type a commandâ€¦">
  </div>
</div>

<script>
// =====================
// SYSTEM STATE
// =====================
let cwd="/home/student", user="student";
let fs={"/":{home:{student:{"readme.txt":{content:"Welcome to Learn Linux.\nLinux rewards curiosity.",perm:"rw-r--r--",type:"text"},"script.sh":{content:"# /bin/bash\necho Hello",perm:"rw-------",type:"shell script"}}}}};
let state={lastCmd:"", testProgress:0, packages:[], mistakes:{}, training: false, trainingQueue: [], trainingIndex:0};

// =====================
// LESSONS (1-5)
// =====================
let lessonIndex=0;
const lessons=[
{ title:"Level 1.1 â€” Where am I?", text:"Show your current directory.", goal:()=>state.lastCmd==="pwd", hint:"pwd" },
{ title:"Level 1.1 â€” What is here?", text:"List the files in this directory.", goal:()=>state.lastCmd==="ls", hint:"ls" },
{ title:"Level 1.2 â€” Move around", text:"Change into root /.", goal:()=>cwd==="/", hint:"cd /" },
{ title:"Level 1.2 â€” Go back home", text:"Return to home.", goal:()=>cwd==="/home/student", hint:"cd /home/student" },
{ title:"Level 1.3 â€” Create a file", text:"Create notes.txt.", goal:()=>resolveDir(cwd)["notes.txt"], hint:"touch notes.txt" },
{ title:"Level 1.3 â€” Read a file", text:"Read readme.txt.", goal:()=>state.lastCmd==="cat readme.txt", hint:"cat readme.txt" },
{ title:"Level 1.4 â€” Who are you?", text:"Show your user.", goal:()=>state.lastCmd==="whoami", hint:"whoami" },
{ title:"Level 1.4 â€” Identity details", text:"Show UID/GID.", goal:()=>state.lastCmd==="id", hint:"id" },
{ title:"ðŸ§ª Level 1 Final Test", text:"Final mini challenge: navigate, read files, show user.", goal:()=>state.testProgress>=5, hint:"Take one command at a time." },

// LEVEL 2
{ title:"Level 2.1 â€” Long listing", text:"List files with details.", goal:()=>state.lastCmd==="ls -l", hint:"ls -l" },
{ title:"Level 2.2 â€” File type", text:"What is script.sh?", goal:()=>state.lastCmd==="file script.sh", hint:"file script.sh" },
{ title:"Level 2.3 â€” Make executable", text:"Make script.sh executable for you.", goal:()=>resolveDir(cwd)["script.sh"].perm.startsWith("rwx"), hint:"chmod u+x script.sh" },
{ title:"Level 2.4 â€” Locate command", text:"Where is ls?", goal:()=>state.lastCmd==="which ls", hint:"which ls" },
{ title:"ðŸ§ª Level 2 Final Test", text:"List permissions, file type, chmod, which command.", goal:()=>state.testProgress>=4, hint:"Step by step." },

// LEVEL 3 â€” Downloads
{ title:"Level 3.1 â€” Download a file", text:"Simulate downloading a file using wget.", goal:()=>resolveDir(cwd)["downloaded.txt"], hint:"wget http://example.com/file.txt" },
{ title:"Level 3.2 â€” Use curl", text:"Simulate downloading another file with curl.", goal:()=>resolveDir(cwd)["curlfile.txt"], hint:"curl -O http://example.com/other.txt" },
{ title:"Level 3.3 â€” Verify download", text:"Check file type of downloaded.txt.", goal:()=>state.lastCmd==="file downloaded.txt", hint:"file downloaded.txt" },
{ title:"Level 3.4 â€” Safe practice", text:"Do NOT execute downloads yet. Understand file location and permissions.", goal:()=>true, hint:"ls -l to check files" },
{ title:"ðŸ§ª Level 3 Final Test", text:"Use wget, curl, check file type. Practice safe handling.", goal:()=>state.testProgress>=3, hint:"Step by step." },

// LEVEL 4 â€” Package management
{ title:"Level 4.1 â€” Update package list", text:"Update the system package list using apt update.", goal:()=>state.lastCmd==="apt update", hint:"apt update" },
{ title:"Level 4.2 â€” Install a package", text:"Install a package (simulate).", goal:()=>state.packages.includes("nano"), hint:"apt install nano" },
{ title:"Level 4.3 â€” List installed packages", text:"See installed packages with dpkg -l.", goal:()=>state.lastCmd==="dpkg -l", hint:"dpkg -l" },
{ title:"Level 4.4 â€” Upgrade packages", text:"Upgrade installed packages.", goal:()=>state.lastCmd==="apt upgrade", hint:"apt upgrade" },
{ title:"ðŸ§ª Level 4 Final Test", text:"Update, install, list packages, upgrade safely.", goal:()=>state.testProgress>=4, hint:"Follow the commands step by step." },

// LEVEL 5 â€” Sysadmin fundamentals
{ title:"Level 5.1 â€” List processes", text:"Show running processes.", goal:()=>state.lastCmd==="ps aux", hint:"ps aux" },
{ title:"Level 5.2 â€” Check memory", text:"Show memory usage.", goal:()=>state.lastCmd==="free -h", hint:"free -h" },
{ title:"Level 5.3 â€” Disk usage", text:"Show disk usage.", goal:()=>state.lastCmd==="df -h", hint:"df -h" },
{ title:"Level 5.4 â€” Schedule a cron job", text:"Simulate adding a cron job.", goal:()=>state.lastCmd==="crontab -l", hint:"crontab -l" },
{ title:"Level 5.5 â€” Network info", text:"Check IP addresses.", goal:()=>state.lastCmd==="ip addr", hint:"ip addr" },
{ title:"ðŸ§ª Level 5 Final Test", text:"Processes, memory, disk, cron, network.", goal:()=>state.testProgress>=5, hint:"Step by step." }
];

// =====================
// UI
// =====================
const instr=document.getElementById("instructions"), term=document.getElementById("terminal"), input=document.getElementById("commandInput");
function loadLesson(){ instr.textContent=`ðŸ“˜ ${lessons[lessonIndex].title}\n\n${lessons[lessonIndex].text}`; }
function print(txt,cls=""){ let d=document.createElement("div"); d.textContent=txt; if(cls)d.className=cls; term.appendChild(d); term.scrollTop=term.scrollHeight; }

// =====================
// LOCAL STORAGE
// =====================
function saveProgress(){ localStorage.setItem("learnLinux", JSON.stringify({lessonIndex,state,cwd,fs})); }
function loadProgress(){ let data=localStorage.getItem("learnLinux"); if(data){ let obj=JSON.parse(data); lessonIndex=obj.lessonIndex||0; state=obj.state||{lastCmd:"",testProgress:0,packages:[],mistakes:{},training:false,trainingQueue:[],trainingIndex:0}; cwd=obj.cwd||"/home/student"; fs=obj.fs||fs; } }
loadProgress();
loadLesson();
print("Welcome to Learn Linux! Press Enter to continue after each lesson.");

// =====================
// INPUT
// =====================
input.addEventListener("keydown", e=>{
  if(e.key==="Enter"){ execute(input.value.trim()); input.value=""; input.focus(); saveProgress(); }
});
document.body.addEventListener("click",()=>input.focus());

// =====================
// COMMAND EXECUTION
// =====================
function execute(cmdline){
  state.lastCmd=cmdline;
  if(cmdline) print(`$ ${cmdline}`,"dim");
  let [cmd,...args]=cmdline.split(" "); let arg=args.join(" ");

  // HELP
  if(cmd==="help"||cmdline.endsWith("-h")) print("Commands: pwd, ls, ls -l, cd, touch, cat, whoami, id, stat, chmod, file, which, wget, curl, apt update/install/upgrade, dpkg -l, ps aux, free -h, df -h, crontab -l, ip addr, hint, skip, training");
  else if(cmd==="hint") print(lessons[lessonIndex].hint,"hint");

  // FILE/NAV
  else if(cmd==="pwd") print(cwd);
  else if(cmd==="ls"&&args[0]==="-l") Object.entries(resolveDir(cwd)).forEach(([n,f])=>print(`${f.perm} ${user} ${n}`));
  else if(cmd==="ls") print(Object.keys(resolveDir(cwd)).join(" "));
  else if(cmd==="cd"){ if(arg==="/") cwd="/"; else if(arg==="..") cwd=cwd.split("/").slice(0,-1).join("/")||"/"; else cwd+="/"+arg; }
  else if(cmd==="touch"){ resolveDir(cwd)[arg]={content:"",perm:"rw-r--r--",type:"text"}; print("File created"); }
  else if(cmd==="cat"){ let f=resolveDir(cwd)[arg]; f?print(f.content):print("No such file","error"); }
  else if(cmd==="whoami") print(user);
  else if(cmd==="id") print(`uid=1000(${user}) gid=1000(${user}) groups=1000(${user})`);
  else if(cmd==="stat"){ let f=resolveDir(cwd)[arg]; f?print(`Permissions: ${f.perm}`):print("No such file","error"); }
  else if(cmd==="chmod"){ let f=resolveDir(cwd)[args[1]]; if(f && args[0]==="u+x"){ f.perm="rwx------"; print("Permissions updated"); } else print("Invalid chmod","error"); }
  else if(cmd==="file"){ let f=resolveDir(cwd)[arg]; f?print(`${arg}: ${f.type}`):print("No such file","error"); }
  else if(cmd==="which") print(`/usr/bin/${arg}`);

  // DOWNLOADS
  else if(cmd==="wget"){ resolveDir(cwd)["downloaded.txt"]={content:"Downloaded content",perm:"rw-r--r--",type:"text"}; print("File downloaded"); }
  else if(cmd==="curl"){ resolveDir(cwd)["curlfile.txt"]={content:"Downloaded content",perm:"rw-r--r--",type:"text"}; print("File downloaded"); }

  // PACKAGE MANAGEMENT
  else if(cmd==="apt"){
    if(args[0]==="update"){ print("Package list updated"); }
    else if(args[0]==="install"){ state.packages.push(args[1]); print(`${args[1]} installed`); }
    else if(args[0]==="upgrade"){ print("Packages upgraded"); }
    else print("Invalid apt command","error");
  }
  else if(cmd==="dpkg" && args[0]==="-l") print("Installed packages: "+state.packages.join(", "));

  // SYSTEM ADMIN (LEVEL 5)
  else if(cmd==="ps"&&args[0]==="aux") print("USER PID COMMAND\nstudent 123 bash");
  else if(cmd==="free"&&args[0]==="-h") print("total used free\nMem: 4G 2G 2G\nSwap:1G 0G 1G");
  else if(cmd==="df"&&args[0]==="-h") print("/dev/sda1 50G 20G 30G /");
  else if(cmd==="crontab"&&args[0]==="-l") print("No cron jobs for student");
  else if(cmd==="ip"&&args[0]==="addr") print("lo: 127.0.0.1\neth0: 192.168.1.10");

  // SKIP
  else if(cmd==="skip"){ if(args[0]){ let target=parseInt(args[0]); if(!isNaN(target)&&target>=0&&target<lessons.length){ lessonIndex=target; state.testProgress=0; loadLesson(); print(`ðŸš€ Skipped to lesson ${target}!`,"hint"); } else print("Invalid lesson number","error"); } else { lessonIndex++; state.testProgress=0; if(lessonIndex<lessons.length) loadLesson(); else instr.textContent="ðŸŽ‰ All lessons completed!"; print("ðŸš€ Skipped to next lesson!","hint"); } }

  // TRAINING MODE
  else if(cmd==="training"){ startTraining(); return; }

  else if(cmdline) print("command not found","error");

  // TRACK MISTAKES
  if(lessons[lessonIndex]?.goal && !lessons[lessonIndex].goal()) state.mistakes[cmdline] = (state.mistakes[cmdline]||0)+1;

  // FINAL TEST TRACKING
  if(lessons[lessonIndex]?.title.includes("Final")){
    const track=["pwd","ls","cd /","cd /home/student","cat readme.txt","whoami","ls -l","file script.sh","chmod u+x script.sh","which ls","wget","curl","file downloaded.txt","apt update","apt install nano","apt upgrade","dpkg -l","ps aux","free -h","df -h","crontab -l","ip addr"];
    if(track.includes(cmdline)) state.testProgress++;
  }

  // AUTO CONTINUE
  if(lessons[lessonIndex]?.goal() && !state.training){
    lessonIndex++; state.testProgress=0;
    if(lessonIndex<lessons.length) loadLesson();
    else instr.textContent="ðŸŽ‰ All lessons completed!";
    print("âœ… Well done. Press Enter to continue.","success");
  }
}

// =====================
// TRAINING MODE
// =====================
function startTraining(){
  state.training=true;
  // weighted lessons based on mistakes
  let candidates = lessons.filter(l=>!l.title.includes("Final"));
  state.trainingQueue = [];
  for(let l of candidates){
    let weight = Math.max(1,(state.mistakes[l.hint]||0));
    for(let i=0;i<weight;i++) state.trainingQueue.push(l);
  }
  shuffle(state.trainingQueue);
  state.trainingIndex=0;
  print("ðŸŽ¯ Training session started! Type the correct command for each instruction.","hint");
  loadTrainingLesson();
}

function loadTrainingLesson(){
  if(state.trainingIndex>=state.trainingQueue.length){ print("ðŸŽ‰ Training complete!","success"); state.training=false; loadLesson(); return; }
  let l=state.trainingQueue[state.trainingIndex];
  instr.textContent=`ðŸŽ¯ Training: ${l.title}\n\n${l.text}`;
}

function shuffle(a){ for(let i=a.length-1;i>0;i--){ let j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }

// =====================
// HELPERS
// =====================
function resolveDir(path){ let p=path.split("/").filter(Boolean); let c=fs["/"]; for(let x of p)c=c[x]; return c; }

</script>
</body>
</html>
