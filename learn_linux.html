<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Learn Linux Terminal Game</title>

<!--
=====================================================
 LEARN LINUX TERMINAL GAME â€” FUNCTION INDEX
=====================================================

UI / TERMINAL
- print()
- resizeTerminal()

FILESYSTEM
- normalizePath()
- resolveDir()
- ensurePath()

LESSONS & MODES
- loadLesson()
- loadTrainingLesson()
- startEndlessMode()

GAME MODES
- normal mode
- training / train
- endless

PLAYER HELP
- help / man
- hint
- answer
- skip [n | level]

EXECUTION
- execute()
- input handler

=====================================================
-->

<style>
  body { font-family: monospace; background:#1e1e1e; color:#e0e0e0; margin:0; }
  #terminal { background:#121212; padding:10px; height:60vh; overflow-y:auto; white-space:pre-wrap; }
  #instructions { padding:10px; background:#222; min-height:50px; }
  #inputWrapper { display:flex; }
  #inputPrompt { padding:10px; color:#0f0; }
  #commandInput { flex:1; padding:10px; background:#1e1e1e; color:#e0e0e0; border:none; outline:none; }
  .success { color:#0f0; }
  .error { color:#f00; }
  .quote { color:#888; font-style:italic; }
</style>
</head>

<body>

<div id="instructions"></div>
<div id="terminal"></div>
<div id="inputWrapper">
  <span id="inputPrompt">$</span>
  <input id="commandInput" autofocus />
</div>

<script>
/* =======================
   BASE STATE
======================= */
let lessonIndex = 0;
let trainingMode = false;
let endlessMode = false;

/* =======================
   HISTORY & STATS
======================= */
let commandHistory = [];
let lessonStats = {}; // { level: { missed, hintsUsed, answersUsed } }

/* =======================
   QUOTES (SECTION COMPLETE)
======================= */
const sectionQuotes = [
  "ðŸ’¡ Linux Wisdom: In Unix, everything is a file.",
  "ðŸš€ Youâ€™re building real muscle memory now.",
  "ðŸ§  The shell is starting to feel like home.",
  "ðŸ”¥ This is how sysadmins are forged.",
  "ðŸ§© Youâ€™re no longer guessing â€” youâ€™re reasoning."
  
];

/* =======================
   HELP SYSTEM
======================= */
const commandHelp = {
  pwd:'print current directory',
  ls:'list directory contents',
  cd:'change directory',
  mkdir:'create directory',
  rmdir:'remove empty directory',
  touch:'create file',
  cat:'print file contents',
  echo:'print message',
  rm:'remove file',
  cp:'copy file',
  mv:'move or rename file',
  clear:'clear terminal',
  history:'show command history',
  help:'list commands',
  man:'list commands',
  skip:'skip lesson',
  hint:'show hint',
  answer:'show exact answer',
  train:'training mode',
  endless:'endless mode',
  status:'show progress',
  menu:'show menu'
};

/* =======================
   LESSONS (FULL 100-COMMAND TEMPLATE)
======================= */

/* 
ðŸ“Œ PASTE THE FULL 100-COMMAND LESSONS HERE

Replace the current "lessons" array with the fully expanded version for lessons 1â€“10.
Example structure for each lesson:
{ level:'6.3', section:6, instructions:'List all files including hidden', goal:'ls -a', hint:'ls -a' },

- Keep the array syntax.
- Make sure to include lessons 6â€“10 fully expanded (80 new commands).
- You can keep levels 1â€“5 as they are.
*/

const lessons = [
 
  // SECTION 1 â€” Basic Navigation
{ level:'1.1', section:1, instructions:'Show current directory', goal:'pwd', hint:'Use pwd to display current directory' },
{ level:'1.2', section:1, instructions:'List files in current directory', goal:'ls', hint:'Use ls to list files' },
{ level:'1.3', section:1, instructions:'List files with details', goal:'ls -l', hint:'Use ls -l for detailed list' },
{ level:'1.4', section:1, instructions:'Print a message', goal:'echo Hello', hint:'Use echo followed by text' },
{ level:'1.5', section:1, instructions:'Create a new empty file hello.txt', goal:'touch hello.txt', hint:'Use touch filename' },
{ level:'1.6', section:1, instructions:'Show contents of hello.txt', goal:'cat hello.txt', hint:'Use cat filename' },
{ level:'1.7', section:1, instructions:'Create directory docs', goal:'mkdir docs', hint:'Use mkdir directoryname' },
{ level:'1.8', section:1, instructions:'Move into docs', goal:'cd docs', hint:'Use cd directoryname' },
{ level:'1.9', section:1, instructions:'Go back to parent directory', goal:'cd ..', hint:'Use cd .. to go up one level' },
{ level:'1.10', section:1, instructions:'Clear the terminal screen', goal:'clear', hint:'Use clear to refresh terminal' },


// SECTION 2 â€” File & Directory Management
{ level:'2.1', section:2, instructions:'Create directory projects', goal:'mkdir projects', hint:'Use mkdir directoryname' },
{ level:'2.2', section:2, instructions:'Enter projects directory', goal:'cd projects', hint:'Use cd directoryname' },
{ level:'2.3', section:2, instructions:'Create nested directories code/src', goal:'mkdir -p code/src', hint:'Use mkdir -p path/to/dir' },
{ level:'2.4', section:2, instructions:'Enter code/src directory', goal:'cd code/src', hint:'Use cd path/to/dir' },
{ level:'2.5', section:2, instructions:'Go back two directories to root', goal:'cd ../..', hint:'Use cd .. to move up' },
{ level:'2.6', section:2, instructions:'Copy hello.txt into projects', goal:'cp hello.txt projects/', hint:'Use cp source dest' },
{ level:'2.7', section:2, instructions:'Move hello.txt to docs directory', goal:'mv hello.txt docs/', hint:'Use mv source dest' },
{ level:'2.8', section:2, instructions:'Remove a test file temp.txt', goal:'rm temp.txt', hint:'Use rm filename' },
{ level:'2.9', section:2, instructions:'Remove empty directory temp', goal:'rmdir temp', hint:'Use rmdir directoryname' },
{ level:'2.10', section:2, instructions:'List files including hidden ones', goal:'ls -a', hint:'Use ls -a to see hidden files' },


// SECTION 3 â€” Viewing & Printing Files
{ level:'3.1', section:3, instructions:'Show current directory path', goal:'pwd', hint:'Use pwd to see your location' },
{ level:'3.2', section:3, instructions:'List files with details', goal:'ls -l', hint:'Use ls -l for detailed listing' },
{ level:'3.3', section:3, instructions:'Print contents of main.py', goal:'cat main.py', hint:'Use cat filename' },
{ level:'3.4', section:3, instructions:'Print a message Hello World', goal:'echo Hello World', hint:'Use echo text' },
{ level:'3.5', section:3, instructions:'Show last 5 lines of main.py', goal:'tail -n 5 main.py', hint:'Use tail -n number filename' },
{ level:'3.6', section:3, instructions:'Show first 5 lines of main.py', goal:'head -n 5 main.py', hint:'Use head -n number filename' },
{ level:'3.7', section:3, instructions:'Display main.py with line numbers', goal:'cat -n main.py', hint:'Use cat -n filename' },
{ level:'3.8', section:3, instructions:'Count number of lines in main.py', goal:'wc -l main.py', hint:'Use wc -l filename' },
{ level:'3.9', section:3, instructions:'Show last 10 commands', goal:'history 10', hint:'Use history number' },
{ level:'3.10', section:3, instructions:'Clear terminal screen', goal:'clear', hint:'Use clear to empty terminal' },


// SECTION 4 â€” Directories & Navigation
{ level:'4.1', section:4, instructions:'Create directory projects', goal:'mkdir projects', hint:'Use mkdir dirname' },
{ level:'4.2', section:4, instructions:'Enter projects directory', goal:'cd projects', hint:'Use cd dirname' },
{ level:'4.3', section:4, instructions:'Create nested directories code/src', goal:'mkdir -p code/src', hint:'Use mkdir -p path/to/dir' },
{ level:'4.4', section:4, instructions:'Enter code/src', goal:'cd code/src', hint:'Use cd path/to/dir' },
{ level:'4.5', section:4, instructions:'Go back to parent directory', goal:'cd ..', hint:'Use cd .. to move up' },
{ level:'4.6', section:4, instructions:'Go back to root directory', goal:'cd /', hint:'Use cd / to go home' },
{ level:'4.7', section:4, instructions:'List contents including hidden files', goal:'ls -a', hint:'Use ls -a' },
{ level:'4.8', section:4, instructions:'List contents with details and hidden', goal:'ls -la', hint:'Use ls -la' },
{ level:'4.9', section:4, instructions:'Print current working directory', goal:'pwd', hint:'Use pwd to check location' },
{ level:'4.10', section:4, instructions:'Remove empty directory src', goal:'rmdir src', hint:'Use rmdir dirname to delete empty dir' },


// SECTION 5 â€” Files & Basic Operations
{ level:'5.1', section:5, instructions:'Create file main.py', goal:'touch main.py', hint:'Use touch filename' },
{ level:'5.2', section:5, instructions:'Show contents of main.py', goal:'cat main.py', hint:'Use cat filename' },
{ level:'5.3', section:5, instructions:'Write message into main.py', goal:'echo "print(\'Hello\')" > main.py', hint:'Use echo "text" > filename' },
{ level:'5.4', section:5, instructions:'Append message to main.py', goal:'echo "print(\'World\')" >> main.py', hint:'Use echo "text" >> filename to append' },
{ level:'5.5', section:5, instructions:'Copy main.py to backup.py', goal:'cp main.py backup.py', hint:'Use cp source dest' },
{ level:'5.6', section:5, instructions:'Rename backup.py to old_main.py', goal:'mv backup.py old_main.py', hint:'Use mv oldname newname' },
{ level:'5.7', section:5, instructions:'Remove old_main.py', goal:'rm old_main.py', hint:'Use rm filename' },
{ level:'5.8', section:5, instructions:'List files with details', goal:'ls -l', hint:'Use ls -l' },
{ level:'5.9', section:5, instructions:'List files sorted by modification time', goal:'ls -lt', hint:'Use ls -lt' },
{ level:'5.10', section:5, instructions:'Clear the terminal', goal:'clear', hint:'Use clear to clean the screen' },


// SECTION 6 â€” Copying, Moving & Directories
{ level:'6.1', section:6, instructions:'Create directory src', goal:'mkdir src', hint:'Use mkdir dirname' },
{ level:'6.2', section:6, instructions:'Move main.py into src', goal:'mv main.py src/', hint:'Use mv file target_dir' },
{ level:'6.3', section:6, instructions:'Copy src/main.py to current directory', goal:'cp src/main.py .', hint:'Use cp source dest' },
{ level:'6.4', section:6, instructions:'Create nested directories src/utils/helpers', goal:'mkdir -p src/utils/helpers', hint:'Use mkdir -p path/to/dir' },
{ level:'6.5', section:6, instructions:'Move src/main.py to src/utils', goal:'mv src/main.py src/utils/', hint:'Use mv source target' },
{ level:'6.6', section:6, instructions:'Copy src/utils/main.py to src/utils/helpers', goal:'cp src/utils/main.py src/utils/helpers/', hint:'Use cp source target_dir' },
{ level:'6.7', section:6, instructions:'List files recursively', goal:'ls -R', hint:'Use ls -R to see all files in subdirs' },
{ level:'6.8', section:6, instructions:'Remove helpers directory', goal:'rm -r src/utils/helpers', hint:'Use rm -r directory' },
{ level:'6.9', section:6, instructions:'Go back to root directory', goal:'cd /', hint:'Use cd / to return to root' },
{ level:'6.10', section:6, instructions:'Show present working directory', goal:'pwd', hint:'Use pwd' },


// SECTION 7 â€” Removing & Cleaning Up
{ level:'7.1', section:7, instructions:'Remove file src/utils/main.py', goal:'rm src/utils/main.py', hint:'Use rm filename' },
{ level:'7.2', section:7, instructions:'Remove empty directory src/utils', goal:'rmdir src/utils', hint:'Use rmdir dirname' },
{ level:'7.3', section:7, instructions:'Remove entire src directory recursively', goal:'rm -r src', hint:'Use rm -r dirname' },
{ level:'7.4', section:7, instructions:'Create directory temp', goal:'mkdir temp', hint:'Use mkdir dirname' },
{ level:'7.5', section:7, instructions:'Move to temp directory', goal:'cd temp', hint:'Use cd dirname' },
{ level:'7.6', section:7, instructions:'Create files file1.txt and file2.txt', goal:'touch file1.txt file2.txt', hint:'Use touch file1 file2' },
{ level:'7.7', section:7, instructions:'List all files', goal:'ls', hint:'Use ls to see files' },
{ level:'7.8', section:7, instructions:'Remove file1.txt', goal:'rm file1.txt', hint:'Use rm filename' },
{ level:'7.9', section:7, instructions:'Go back to root directory', goal:'cd /', hint:'Use cd /' },
{ level:'7.10', section:7, instructions:'Show current directory', goal:'pwd', hint:'Use pwd' },


// SECTION 8 â€” History & Navigation Practice
{ level:'8.1', section:8, instructions:'Show command history', goal:'history', hint:'Use history' },
{ level:'8.2', section:8, instructions:'Repeat last command', goal:'!!', hint:'Use !! to repeat last command' },
{ level:'8.3', section:8, instructions:'Show last 5 commands', goal:'history | tail -n 5', hint:'Use history | tail -n 5' },
{ level:'8.4', section:8, instructions:'Go to previous directory', goal:'cd -', hint:'Use cd -' },
{ level:'8.5', section:8, instructions:'Create directory logs', goal:'mkdir logs', hint:'Use mkdir dirname' },
{ level:'8.6', section:8, instructions:'Enter logs directory', goal:'cd logs', hint:'Use cd dirname' },
{ level:'8.7', section:8, instructions:'Create log1.txt and log2.txt', goal:'touch log1.txt log2.txt', hint:'Use touch files' },
{ level:'8.8', section:8, instructions:'List files with details', goal:'ls -l', hint:'Use ls -l' },
{ level:'8.9', section:8, instructions:'Remove log1.txt', goal:'rm log1.txt', hint:'Use rm filename' },
{ level:'8.10', section:8, instructions:'Go back to root directory', goal:'cd /', hint:'Use cd /' },


// SECTION 9 â€” Terminal Maintenance & Clearing
{ level:'9.1', section:9, instructions:'Clear the terminal', goal:'clear', hint:'Use clear' },
{ level:'9.2', section:9, instructions:'Show hidden files', goal:'ls -a', hint:'Use ls -a to see hidden files' },
{ level:'9.3', section:9, instructions:'List files in long format with human-readable sizes', goal:'ls -lh', hint:'Use ls -lh' },
{ level:'9.4', section:9, instructions:'List all files sorted by modification time', goal:'ls -lt', hint:'Use ls -lt' },
{ level:'9.5', section:9, instructions:'List all files sorted by size', goal:'ls -lS', hint:'Use ls -lS' },
{ level:'9.6', section:9, instructions:'Print only directories', goal:'ls -d */', hint:'Use ls -d */' },
{ level:'9.7', section:9, instructions:'Show current directory contents recursively', goal:'ls -R', hint:'Use ls -R' },
{ level:'9.8', section:9, instructions:'Display last 10 lines of a file log.txt', goal:'tail log.txt', hint:'Use tail filename' },
{ level:'9.9', section:9, instructions:'Display first 10 lines of a file log.txt', goal:'head log.txt', hint:'Use head filename' },
{ level:'9.10', section:9, instructions:'Show current processes', goal:'ps', hint:'Use ps to see processes' },


// SECTION 10 â€” Advanced File & System Commands
{ level:'10.1', section:10, instructions:'Show current directory again', goal:'pwd', hint:'Use pwd' },
{ level:'10.2', section:10, instructions:'Copy entire directory projects to backup', goal:'cp -r projects backup', hint:'Use cp -r source dest' },
{ level:'10.3', section:10, instructions:'Remove a directory safely', goal:'rm -r old_dir', hint:'Use rm -r directory_name' },
{ level:'10.4', section:10, instructions:'Move a file to another directory', goal:'mv notes.txt docs/', hint:'Use mv file target_dir' },
{ level:'10.5', section:10, instructions:'Find all .txt files in current directory', goal:'find . -name "*.txt"', hint:'Use find with -name pattern' },
{ level:'10.6', section:10, instructions:'Count lines in file.txt', goal:'wc -l file.txt', hint:'Use wc -l filename' },
{ level:'10.7', section:10, instructions:'Search for "error" in log.txt', goal:'grep "error" log.txt', hint:'Use grep "pattern" filename' },
{ level:'10.8', section:10, instructions:'Show disk usage of current directory', goal:'du -h', hint:'Use du -h' },
{ level:'10.9', section:10, instructions:'Show free memory', goal:'free -h', hint:'Use free -h' },
{ level:'10.10', section:10, instructions:'Exit the terminal game', goal:'exit', hint:'Type exit' },


  /* 
  âœ… FULLY EXPANDED LESSONS 6â€“10 SHOULD GO HERE
  Each lesson should have:
    - unique level id (e.g., '6.3', '7.2', '10.10', etc.)
    - section number
    - instructions
    - goal (command to type)
    - hint
  Make sure total lessons array reaches 100 entries.
  */
];

/* =======================
   FILESYSTEM
======================= */
let fs = { '/':{type:'dir',children:{}} };
let cwd = '/';

function normalizePath(path){
  if(!path.startsWith('/')) path = cwd + '/' + path;
  let parts = path.split('/').filter(Boolean);
  let stack=[];
  for(let p of parts){
    if(p==='..') stack.pop();
    else if(p!=='.') stack.push(p);
  }
  return '/' + stack.join('/');
}

function resolveDir(path){
  let full=normalizePath(path);
  let node=fs['/'];
  if(full==='/') return node;
  for(let p of full.slice(1).split('/')){
    if(!node.children[p]||node.children[p].type!=='dir') return null;
    node=node.children[p];
  }
  return node;
}

function ensurePath(path){
  let full=normalizePath(path);
  let node=fs['/'];
  for(let p of full.slice(1).split('/')){
    if(!node.children[p]) node.children[p]={type:'dir',children:{}};
    node=node.children[p];
  }
  return node;
}

/* =======================
   TERMINAL
======================= */
const terminal=document.getElementById('terminal');
const instructionsDiv=document.getElementById('instructions');
const input=document.getElementById('commandInput');

function print(msg,type=''){
  let d=document.createElement('div');
  if(type) d.className=type;
  d.textContent=msg;
  terminal.appendChild(d);
  terminal.scrollTop=terminal.scrollHeight;
}

/* =======================
   LOAD LESSON
======================= */
function loadLesson(){
  if(lessonIndex>=lessons.length){
    instructionsDiv.textContent='ðŸŽ‰ Course complete.';
    print(sectionQuotes[Math.floor(Math.random()*sectionQuotes.length)],'quote');
    return;
  }
  let l=lessons[lessonIndex];
  instructionsDiv.textContent=`[Level ${l.level}] ${l.instructions}`;
}

/* =======================
   TRAINING MODE
======================= */
let trainingQueue=[];
function loadTrainingLesson(){
  trainingQueue=Object.entries(lessonStats)
    .filter(e=>e[1].missed||e[1].hintsUsed||e[1].answersUsed)
    .map(e=>lessons.find(l=>l.level===e[0]));
  if(!trainingQueue.length) trainingQueue=[lessons[0]];
  trainingMode=true; endlessMode=false;
  instructionsDiv.textContent=`[Training ${trainingQueue[0].level}] ${trainingQueue[0].instructions}`;
}

/* =======================
   ENDLESS MODE
======================= */
let endlessQueue=[], endlessCurrent=null;
function startEndlessMode(){
  endlessMode=true; trainingMode=false;
  endlessQueue=[...lessons];
  endlessQueue.sort(()=>Math.random()-0.5);
  endlessCurrent=endlessQueue[0];
  ensurePath(cwd);
  instructionsDiv.textContent=`[Endless] ${endlessCurrent.instructions}`;
}

/* =======================
   EXECUTION
======================= */
function execute(cmd) {
    cmd = cmd.trim();
    if(!cmd) return;
    commandHistory.push(cmd);

    const args = cmd.split(' ');
    const command = args[0];

    // ===== Helper: Normalize commands for lesson check =====
    function normalizeUserCommand(userCmd) {
        let c = userCmd.trim();

        // Echo: accept anything after echo
        if(c.startsWith('echo')) return c;

        // History: strip numbers
        if(c.startsWith('history')) return 'history';

        // Remove trailing slashes for cp, mv, rm, rmdir, mkdir, cd
        if(['cp','mv','rm','rmdir','mkdir','cd'].includes(c.split(' ')[0])) {
            c = c.split(' ').map((part,i)=>{
                if(i>0) return part.replace(/\/$/,'');
                return part;
            }).join(' ');
        }

        // Sort flags for ls
        if(c.startsWith('ls')) {
            const parts = c.split(' ');
            if(parts[1] && parts[1].startsWith('-')) {
                const flags = parts[1].slice(1).split('').sort().join('');
                return 'ls -' + flags;
            }
        }

        return c;
    }

    function normalizeLessonGoal(goal) {
        let g = goal.trim();
        if(g.startsWith('echo')) return g;
        if(g.startsWith('history')) return 'history';
        if(['cp','mv','rm','rmdir','mkdir','cd'].includes(g.split(' ')[0])) {
            g = g.split(' ').map((part,i)=>{
                if(i>0) return part.replace(/\/$/,'');
                return part;
            }).join(' ');
        }
        if(g.startsWith('ls')) {
            const parts = g.split(' ');
            if(parts[1] && parts[1].startsWith('-')) {
                const flags = parts[1].slice(1).split('').sort().join('');
                return 'ls -' + flags;
            }
        }
        return g;
    }

    // ===== SPECIAL COMMANDS =====
    if(cmd==='train' || cmd==='training'){ loadTrainingLesson(); return; }
    if(cmd==='endless'){ startEndlessMode(); return; }
    if(cmd==='exit'){ trainingMode=false; endlessMode=false; loadLesson(); return; }

    if(command==='help' || command==='man'){ print(Object.keys(commandHelp).join(', ')); return; }

    // ===== MENU WITH SECTION DESCRIPTIONS =====
    if(command==='menu'){
        print('Commands: help, status, skip, hint, answer, train, endless, exit');
        print('Sections Overview:');
        const sectionDescriptions = {
            1: 'Basic Navigation: Learn pwd, ls, cd, and moving around directories',
            2: 'File & Directory Management: Create, copy, move, and remove files and folders',
            3: 'Viewing & Printing Files: cat, head, tail, echo, and file contents',
            4: 'Directories & Navigation: Nested directories and advanced listing',
            5: 'Files & Basic Operations: Touch, copy, move, rename, remove, clear',
            6: 'Copying, Moving & Directories: Practice cp, mv, mkdir -p, ls -R',
            7: 'Removing & Cleaning Up: Delete files/directories safely',
            8: 'History & Navigation Practice: Repeat commands, check history, cd -',
            9: 'Terminal Maintenance & Clearing: ls flags, du, free, ps',
            10:'Advanced File & System Commands: find, grep, wc, exit, backups'
        };
        for(let sec in sectionDescriptions){
            print(`${sec}: ${sectionDescriptions[sec]}`);
        }
        return;
    }

    if(command==='status'){ print(`Lesson ${lessonIndex+1}/${lessons.length} | Training:${trainingMode} | Endless:${endlessMode}`); return; }

    // ===== HINT / ANSWER / SKIP =====
    let l = endlessMode ? endlessCurrent : trainingMode ? trainingQueue[0] : lessons[lessonIndex];

    if(command==='hint'){
        lessonStats[l.level] = lessonStats[l.level] || {missed:0, hintsUsed:0, answersUsed:0};
        lessonStats[l.level].hintsUsed++;
        print(l.hint); 
        return;
    }

    if(command==='answer'){
        lessonStats[l.level] = lessonStats[l.level] || {missed:0, hintsUsed:0, answersUsed:0};
        lessonStats[l.level].answersUsed++;
        print(`Answer: ${l.goal}`, 'quote'); 
        return;
    }

    if(command==='skip'){
        if(args[1]){
            if(!isNaN(args[1])) {
                // numeric skip
                lessonIndex += parseInt(args[1]);
            } else {
                // skip to specific lesson level
                const foundIndex = lessons.findIndex(l=>l.level===args[1]);
                if(foundIndex !== -1) lessonIndex = foundIndex;
                else { print('Lesson not found','error'); return; }
            }
        } else {
            lessonIndex++;
        }

        if(lessonIndex < 0) lessonIndex = 0;
        if(lessonIndex >= lessons.length) lessonIndex = lessons.length-1;

        // Update instructions for current mode
        if(!endlessMode && !trainingMode){
            loadLesson();
        } else if(endlessMode){
            endlessQueue.push(endlessQueue.shift());
            endlessCurrent = endlessQueue[0];
            instructionsDiv.textContent = `[Endless] ${endlessCurrent.instructions}`;
        } else if(trainingMode){
            trainingQueue.push(trainingQueue.shift());
            instructionsDiv.textContent = `[Training ${trainingQueue[0].level}] ${trainingQueue[0].instructions}`;
        }

        print(`â© Skipped to ${args[1] || 'next'} lesson`, 'quote');
        return;
    }

    // ===== NORMAL COMMANDS =====
    switch(command){
        case 'pwd': print(cwd); break;
        case 'ls': 
            let lsFlags = args[1] ? args[1].slice(1).split('').sort().join('') : '';
            print(Object.keys(resolveDir(cwd).children).join(' ')); 
            break;
        case 'cd': 
            if(!args[1]) args[1] = '/';
            let target = args[1]==='..' ? cwd.split('/').slice(0,-1).join('/')||'/' : args[1];
            let t=resolveDir(target);
            if(t) cwd=normalizePath(target);
            else print('No such dir','error'); 
            break;
        case 'mkdir': ensurePath(args[1]); break;
        case 'touch': {
            let dirNode = resolveDir(cwd);
            args.slice(1).forEach(f=> dirNode.children[f]={type:'file', content:''});
            break;
        }
        case 'cat': {
            let fileNode = resolveDir(cwd).children[args[1]];
            if(fileNode && fileNode.type==='file') print(fileNode.content||''); 
            else print('No such file','error'); 
            break;
        }
        case 'echo': print(args.slice(1).join(' ')); break;
        case 'rm': args.slice(1).forEach(f=> delete resolveDir(cwd).children[f]); break;
        case 'cp': {
            let src = args[1];
            let dest = args[2];
            let destNode = resolveDir(cwd).children[dest];
            if(destNode && destNode.type==='dir') dest = dest + '/' + src;
            resolveDir(cwd).children[dest] = JSON.parse(JSON.stringify(resolveDir(cwd).children[src]));
            break;
        }
        case 'mv': {
            let src = args[1];
            let dest = args[2];
            let destNode = resolveDir(cwd).children[dest];
            if(destNode && destNode.type==='dir') dest = dest + '/' + src;
            resolveDir(cwd).children[dest] = resolveDir(cwd).children[src];
            delete resolveDir(cwd).children[src];
            break;
        }
        case 'rmdir': delete resolveDir(cwd).children[args[1]]; break;
        case 'clear': terminal.innerHTML=''; break;
        case 'history': commandHistory.forEach((c,i)=>print(`${i+1} ${c}`)); break;
        default: print('Command not recognized','error');
    }

    // ===== LESSON COMPLETION CHECK =====
    l = endlessMode ? endlessCurrent : trainingMode ? trainingQueue[0] : lessons[lessonIndex];
    if(normalizeUserCommand(cmd) === normalizeLessonGoal(l.goal)){
        print('âœ… Correct', 'success');

        if (endlessMode){
            endlessQueue.push(endlessQueue.shift());
            endlessCurrent = endlessQueue[0];
            instructionsDiv.textContent = `[Endless] ${endlessCurrent.instructions}`;
        } else if (trainingMode){
            trainingQueue.push(trainingQueue.shift());
            instructionsDiv.textContent = `[Training ${trainingQueue[0].level}] ${trainingQueue[0].instructions}`;
        } else {
            let prevSection = l.section;
            lessonIndex++;
            if (lessons[lessonIndex] && lessons[lessonIndex].section !== prevSection){
                print(sectionQuotes[Math.floor(Math.random() * sectionQuotes.length)], 'quote');
            }
            loadLesson();
        }
    } else {
        lessonStats[l.level] = lessonStats[l.level] || { missed:0, hintsUsed:0, answersUsed:0 };
        lessonStats[l.level].missed++;
    }
}






 // <-- THIS IS THE END OF execute(cmd)


/* =======================
   INPUT
======================= */
input.addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    print(`$ ${input.value}`);
    execute(input.value);
    input.value='';
  }
});

/* =======================
   INIT
======================= */
print('Welcome to Learn Linux Terminal Game');
print('Type help or man to see commands');
print('Use hint, answer, skip, train, endless');
print('there may be bugs but it works good as practice');
loadLesson();

function resizeTerminal(){
  terminal.style.height=(window.innerHeight-instructionsDiv.offsetHeight-input.offsetHeight-30)+'px';
}
window.addEventListener('resize',resizeTerminal);
resizeTerminal();
</script>
</body>
</html>
